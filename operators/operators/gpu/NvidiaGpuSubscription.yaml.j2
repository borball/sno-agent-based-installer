{% set default_source='certified-operators' -%}
{% for item in customs|select(attribute='provide', value='certified-operators') -%}
  {% set default_source=item.name -%}
{% endfor -%}
---
# https://docs.nvidia.com/datacenter/cloud-native/openshift/latest/install-gpu-ocp.html
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: gpu-operator-certified
  namespace: nvidia-gpu-operator
spec:
  name: gpu-operator-certified
  channel: {{ channel | default('v24.9') }}
  source: {{ source | default(default_source) }}
  sourceNamespace: openshift-marketplace
  {% if version is defined and version is not none -%}
  startingCSV: {{ version }}
  installPlanApproval: Manual
  {% else -%}
  installPlanApproval: Automatic
  {%- endif %}
